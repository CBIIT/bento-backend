---
- name: Add/Remove alb rules
  hosts: docker-local
  connection: local
  gather_facts: yes
    
  tasks:
    - name: create alb rule
      include_role:
        name: alb-ops
        tasks_from: remove-alb-rules
      when: action == "create"

    - name: remove alb rule
      command: >
        aws elbv2 create-rule 
        --listener-arn {{lookup('file', '{{workspace}}/rule-arn.txt')}}
        --region {{region}}
      register: rule
      when: action == "remove"

    - name: purge rule-arn.txt file
      file: 
        path: "{{workspace}}/rule-arn.txt"
        state: absent
      when: action == "remove"