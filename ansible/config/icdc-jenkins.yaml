jenkins:
  systemMessage: "This jenkins instance is for icdc program"
  agentProtocols:
    - "JNLP4-connect"
  securityRealm:
    local:
      allowsSignup: false
      users:
        - id: jenkinsAdmin
          password: ${jenkinsAdmin}
  authorizationStrategy:
    globalMatrix:
      grantedPermissions:
        - "Overall/Read:authenticated"
        - "Job/Read:authenticated"
        - "View/Read:authenticated"
        - "Overall/Administer:authenticated"
  crumbIssuer: "standard"
  clouds:
    - docker:
        name: "docker"
        dockerApi:
          dockerHost:
            uri: "tcp://${DOCKER_AGENT_IP}:2375"
        templates:
          - labelString: "icdc_maven"
            dockerTemplateBase:
              image: "vdonkor/cicd-maven"
              environmentsString: |
                TOMCAT01_IP=${TOMCAT01_IP}
                TOMCAT02_IP=${TOMCAT02_IP}
                SLACK_URL=${SLACK_URL}
                NEO4J_IP=${NEO4J_IP}
            remoteFs: "/home/jenkins"
            connector:
              attach:
                user: "root"
            instanceCapStr: "10"

  nodes:
    - permanent:
        name: "static1"
        remoteFS: "./jenkins-agent-dir"
        labelString: "icdc_dockerbuild"
        launcher:
          ssh:
            credentialsId: server_ssh_key
            host: ${jenkins_ip}
            SshHostKeyVerificationStrategy: nonVerifyingKeyVerificationStrategy
    - permanent:
        labelString: "selenium"
        mode: NORMAL
        name: "selenium-testing"
        numExecutors: 4
        remoteFS: "/home/centos"
        launcher:
          SSHLauncher:
            host: ${DOCKER_AGENT_IP}
            port: 22
            credentialsId: deployer_ssh_key
            launchTimeoutSeconds: 60
            maxNumRetries: 3
            retryWaitTime: 30
            sshHostKeyVerificationStrategy: nonVerifyingKeyVerificationStrategy
              
jobs:
  - script: >
      folder('icdc')
  - script: >
      pipelineJob('icdc/k9dc') {
          def repo = 'https://github.com/CBIIT/icdc-devops.git'
          description("icdc k9 pipeline Job")
          definition {
              cpsScm {
                  scm {
                    git {
                        remote { url(repo) }
                        branch('master')
                        scriptPath('jenkins/jobs/icdc/Jenkinsfile')
                        extensions {}
                    }
                  }
              }
          }
      }
  - script: >
      pipelineJob('icdc/canine-testing') {
          def repo = 'https://github.com/CBIIT/icdc-devops.git'
          description("icdc canine-testing")
          definition {
              cpsScm {
                  scm {
                    git {
                        remote { url(repo) }
                        branch('master')
                        scriptPath('jenkins/jobs/canine-testing/Jenkinsfile')
                        extensions {}
                    }
                  }
              }
          }
      }
tool:
  git:
    installations:
      - name: Default
        home: git
  jdk:
    installations:
      - name: jdk11
        home: /usr/lib/jvm/jre-11-openjdk
  maven:
    installations:
      - name: maven-3.6.1
        home: /usr/local/maven
  xvfbInstallation:
    installations:
      - name: Xvfb
      
credentials:
  system:
    domainCredentials:
      - credentials:
          - string:
              scope: GLOBAL
              id: authorization_bearer
              secret: "${bearer}"
              description: neo4j authorization bearer
          - usernamePassword:
              scope: GLOBAL
              id: c9c-deployer
              username: "icdcTomcat"
              password: ${jenkinsAdmin}
              description: user for deploying c9c
          - usernamePassword:
              scope: GLOBAL
              id: vdonkor
              username: vdonkor
              password: ${vdonkor}
              description: github checkout
          - usernamePassword:
              scope: GLOBAL
              id: neo4j_user
              username: neo4j
              password: ${neo4j}
              description: neo4j db user and password
          - basicSSHUserPrivateKey:
              scope: GLOBAL
              id: deployer_ssh_key
              username: centos
              description: "ssh key for deploying application"
              privateKeySource:
                directEntry:
                  privateKey: ${sshkey}
          - basicSSHUserPrivateKey:
              scope: GLOBAL
              id: server_ssh_key
              username: centos
              description: "ssh key for connecting to server as centos"
              privateKeySource:
                directEntry:
                  privateKey: ${server_sshkey}
