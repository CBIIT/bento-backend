---
- name: load data to neo4j db
  hosts: loader
  connection: local
  gather_facts: yes
  become: yes

  tasks:
    - name: gather instance facts
      ec2_instance_facts:
        region: us-east-1
        filters:
          "tag:Name": "{{ project }}-{{ tier }}-neo4j-4"
          "instance-state-name": running
          "tag:Environment": "{{ tier }}"
      register: neo4j

    - name: set instance name
      set_fact:
        neo4j_ip: "{{ neo4j.instances[0].network_interfaces[0].private_ip_address }}"

    - name: perform data loading
      include_role:
        name: common
        tasks_from: data-loader
      vars:
        model_file1: "{{workspace}}/ctdc-model/model-desc/ctdc_model_file.yaml"
        model_file2: "{{workspace}}/ctdc-model/model-desc/ctdc_model_properties_file.yaml"
        property_file: "config/props-ctdc.yml"
        bucket: bento-ctdc-metadata
        ansible_python_interpreter: /usr/bin/python2.7
