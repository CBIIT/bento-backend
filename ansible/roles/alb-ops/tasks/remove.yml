- name: get {{tier}}-rule-arn file content
  command: cat {{workspace}}/{{tier}}-rule-arn.json
  register: result

- name: retrieve rule-arn
  set_fact:
    jsondata: "{{ result.stdout | from_json }}"
    
- name: remove alb rule
  command: >
    aws elbv2 delete-rule 
    --rule-arn {{jsondata|json_query('Rules[].RuleArn')|join('')}}
    --region {{region}}
  register: rule
  
- name: purge rule-arn.txt file
  file: 
    path: "{{workspace}}/{{tier}}-rule-arn.json"
    state: absent
      