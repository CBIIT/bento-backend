---
- name: update python version
  shell: "yum upgrade python3"
  args:
    chdir: "{{ workspace }}"

- name: get python version
  shell: "python3 --version"
  args:
    chdir: "{{ workspace }}"
  register: python_ver

- name: echo python version
  debug:
    msg: "{{ python_ver.stdout_lines }}"

- name: clone docs repo
  shell: git clone https://github.com/CBIIT/bento-docs.git
  args:
    chdir: "{{ workspace }}"

- name: get repo commit ID
  shell: git rev-parse HEAD
  args:
    chdir: "{{ workspace }}/bento-docs"
  register: repo_commit

- name: echo repo commit
  debug:
    msg: "{{ repo_commit.stdout_lines }}"

- name: get python requirements
  shell: "pip3 install -r requirements.txt"
  args:
    chdir: "{{ workspace }}/bento-docs"

- name: build latest docs
  shell: "sphinx-multiversion source docs"
  args:
    chdir: "{{ workspace }}/bento-docs"
  register: sphinx_out

- name: echo sphinx output
  debug:
    msg: "{{ sphinx_out.stdout_lines }}"