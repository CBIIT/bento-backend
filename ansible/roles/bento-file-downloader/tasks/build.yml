---
#################################################################################################

- name: log into DockerHub
  docker_login:
    username: "{{docker_user}}"
    password: "{{docker_password}}"

# - name: copy entrypoint.sh to workspace
#   copy:
#     src: "nginx-entrypoint.sh"
#     dest: "{{workspace}}/bento-frontend/nginx-entrypoint.sh"
#     mode: 0755

# - name: copy env to dist
#   copy:
#     # remote_src: yes
#     src: inject.template.js
#     dest: "{{workspace}}/bento-frontend/dist/inject.template.js"
#     mode: 0755
          

- name: build cbiitssrepo/bento-filedownloader image
  docker_image:
    build:
      path: "{{workspace}}/bento-files"
      dockerfile: "{{workspace}}/icdc-devops/docker/dockerfiles/filedownload-dockerfile"
      pull: yes
      nocache: yes
    name: cbiitssrepo/bento-filedownloader
    tag: "{{downloader_version}}-{{build_number}}"
    push: yes
    force_source: yes
    source: build

- name: Add tag latest to cbiitssrepo/bento-filedownloader image
  docker_image:
    name: "cbiitssrepo/bento-filedownloader:{{downloader_version}}-{{build_number}}"
    repository: cbiitssrepo/bento-filedownloader:latest
    force_tag: yes
    push: yes
    source: local

    