---
# tasks file for k9dc
# - name: open http and https services
#   firewalld:
#     service: "{{item}}"
#     zone: public
#     immediate: yes
#     permanent: yes
#     state: enabled
#   loop:
#     - http
#     - https
    
# - name: create tomcat group
#   group:
#     name: tomcat
#     gid: 46
#     state: present

# - name: create tomcat user
#   user:
#     name: tomcat
#     uid: 46
#     group: tomcat

- name: create k9dc volume/directory
  file:
    path: "{{ item }}"
    state: directory
    owner: tomcat
    group: tomcat
  loop:
    - "{{ k9dc_home }}"
    - "{{ k9dc_home }}/logs"

- name: create k9dc deployments directory
  file:
    path: "{{ item }}"
    state: directory
    owner: commonsdocker
    group: commonsdocker
  loop:
    - "{{ deployments }}"
    - "{{ docker_home }}"

- name: copy docker files
  template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    owner: commonsdocker
    group: commonsdocker
  with_items:
    - {src: 'docker-compose.yml.j2',dest: '{{docker_home}}/docker-compose.yml'}

# - name: start the k9dc
#   docker_compose:
#     project_src: "{{ docker_home }}"
#     state: present

- name: start k9dc
  command: docker-compose up -d
  args:
    chdir: "{{ docker-home }}"
    warn: no