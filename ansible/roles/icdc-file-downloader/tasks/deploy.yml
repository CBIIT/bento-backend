---
- name: log into DockerHub
  docker_login:
    username: "{{ docker_user }}"
    password: "{{ docker_password }}"
    registry: https://ncidockerhub.nci.nih.gov

- name: remove frontend container
  docker_container:
    name: file-downloader
    state: absent

- name: clean up 
  command: docker system prune -a -f

- name: ensure log and docker directory exists
  file: 
    path: /local/content/k9dc/file-downloader
    state: directory

- name: launch the new file-downloader
  docker_container:
    name: file-downloader
    image: ncidockerhub.nci.nih.gov/icdc/icdc-filedownloader:{{downloader_version}}
    env:
      URL_SRC: indexd
      INDEXD_URL: "{{indexd_url}}"
      VERSION: "{{downloader_version}}" 
      DATE: "{{ansible_date_time.date}}"
      PROJECT: "ICDC" 
    restart_policy: always
    ports:
      - "8081:8081"
    volumes:
      - "/local/content/k9dc/file-downloader:/var/log"
