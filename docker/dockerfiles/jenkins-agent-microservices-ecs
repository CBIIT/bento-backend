FROM jenkins/inbound-agent:latest-jdk11

ENV JAVA_HOME /usr/lib/jvm/jre-11-openjdk
ENV MAVEN_HOME /usr/local/maven
ENV PATH $MAVEN_HOME/bin:$JAVA_HOME/bin:$PATH
ENV NODE_VERSION=15.13.0
ARG MAVEN_VERSION=3.6.3
USER root
RUN apt-get update \
  && apt-get -y install openjdk-11-jdk wget which device-mapper-persistent-data lvm2 redis\
  && wget https://www-us.apache.org/dist/maven/maven-3/$MAVEN_VERSION/binaries/apache-maven-$MAVEN_VERSION-bin.tar.gz -P /tmp \
  && tar xf /tmp/apache-maven-$MAVEN_VERSION-bin.tar.gz -C /usr/local \
  && ln -s /usr/local/apache-maven-$MAVEN_VERSION /usr/local/maven 

RUN apt-get update \
  && apt-get install -y apt-transport-https ca-certificates curl software-properties-common \
  && curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - \
  && add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable" \
  && apt-cache policy docker-ce \
  && apt-get -y install docker-ce docker-ce-cli containerd.io

RUN curl -sL https://deb.nodesource.com/setup_15.x | sudo -E bash - \
  && apt-get update \
  && apt-get install -y nodejs \
  && npm install -g yarn\
  && n $NODE_VERSION \
  && yarn --version \
  && usermod -aG docker jenkins

RUN apt-get install -y jq python3 python3-pip \ 
  && /usr/bin/pip3 install pip -U \
  && /usr/bin/pip3 install ansible==2.9.0 awscli jmespath docker boto botocore boto3\
  && mkdir -p /var/cert
  
RUN apt-get clean