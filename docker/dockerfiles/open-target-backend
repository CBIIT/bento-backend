FROM alpine:latest

ENV JAVA_HOME="/usr/lib/jvm/default-jvm/"
RUN apk add openjdk11 bash curl

ENV PATH=$PATH:${JAVA_HOME}/bin

RUN cd /tmp \
&& curl -O https://download.newrelic.com/newrelic/java-agent/newrelic-agent/current/newrelic-java.zip \
&& unzip /tmp/newrelic-java.zip \
&& mkdir -p /usr/local/tomcat/newrelic \
&& cp /tmp/newrelic/newrelic.jar /usr/local/tomcat/newrelic/newrelic.jar \
&& cp /tmp/new-relic/newrelic.yml /usr/local/tomcat/newrelic/newrelic.yml

COPY app /app
EXPOSE 8080
CMD /app/bin/start -Dhttp.port="8080" -Dplay.http.secret.key="chslslkdangethisssksksaosometkdakdhingsecretkslakdd" -Dconfig.file=/app/conf/production.conf -Dlogger.file=/app/conf/production.xml
