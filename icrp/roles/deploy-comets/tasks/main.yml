---
# tasks file for deploy-comets

- name: Check if comets and exits 
  stat:
    path: /tmp/comets
  register: comets_result

- name: remove old comets repo
  file:
    path: /tmp/comets
    state: absent
  when: comets_result.stat.exists

- name: Check if R-cometsAnalytics exits 
  stat:
    path: /tmp/R-cometsAnalytics
  register: r_result

- name: remove old r repo
  file:
    path: /tmp/R-cometsAnalytics
    state: absent
  when: r_result.stat.exists

#create app and logs directory
- name: create app and logs directory
  file: 
    path: "{{app_base_directory}}/{{item}}"
    state: directory
  loop:
    - app
    - logs

- name: checkout comets repo
  git:
    repo: "{{comets_repo}}"
    dest: /tmp/comets
    version: master
    force: yes

- name: checkout R repo
  git:
    repo: "{{r_repo}}"
    dest: /tmp/
    version: comets_1.6.0_20191205
    force: yes








    # - git clone https://github.com/CBIIT/nci-webtools-comets-analytics /tmp/comets
    # - cd /tmp/ && git clone https://github.com/CBIIT/R-cometsAnalytics
    # - mkdir -p /local/content/docker/comets/{app,logs}
    # - rsync -a /tmp/comets/comets/ /local/content/docker/comets/app/
    # - cd /tmp/R-cometsAnalytics && git checkout comets_1.6.0_20191205
    # - rsync -a /tmp/R-cometsAnalytics/ /local/content/docker/comets/app/restricted/rcode/
    # - systemctl restart docker